name: ICA Integration Tests

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]
  workflow_dispatch:
    inputs:
      lumera_version:
        description: "Lumera version to test (e.g. v1.10.1)"
        required: false
        default: "v1.10.1"

env:
  LUMERA_VERSION: ${{ github.event.inputs.lumera_version || 'v1.10.1' }}

jobs:
  full-test:
    name: Full Test (build + genesis + ICA)
    runs-on: ubuntu-latest
    timeout-minutes: 45

    steps:
      - name: Checkout
        uses: actions/checkout@v6.0.1

      - name: Set up Go
        uses: ./.github/actions/setup-go

      - name: Build Docker image
        run: make build-docker LUMERA_VERSION=${{ env.LUMERA_VERSION }}

      - name: Run tests
        run: make test-local LUMERA_VERSION=${{ env.LUMERA_VERSION }}
